(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(6978)}])},6978:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(5893),r=s(9008),a=s.n(r),l=s(7294);async function i(e){try{return(await fetch("http://localhost:8080/games/user/"+e)).json()}catch(e){return console.log(e),Promise.resolve(null)}}function c(e){let{onSelect:t,game:s,userId:r,index:a,selectedItem:l}=e,{users:i,created_at:c,last_message:o}=s,u=new Date(c),d=u.getHours()>=12?"PM":"AM",m="".concat(u.getHours(),":").concat(u.getMinutes()," ").concat(d),x=null==i?void 0:i.filter(e=>e.id!=r).map(e=>e.username)[0];return(0,n.jsx)("div",{onClick:()=>t(a,{}),className:"".concat(a==l?"bg-[#FDF9F0] border border-[#DEAB6C]":"bg-[#FAF9FE] border border-[#FAF9FE]"," p-2 rounded-[10px] shadow-sm cursor-pointer"),children:(0,n.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,n.jsx)("div",{className:"flex gap-3 items-center w-full",children:(0,n.jsxs)("div",{className:"w-full max-w-[150px]",children:[(0,n.jsx)("h3",{className:"font-semibold text-sm text-gray-700",children:x}),(0,n.jsx)("p",{className:"font-light text-xs text-gray-600 truncate",children:o})]})}),(0,n.jsx)("div",{className:"text-gray-400 min-w-[55px]",children:(0,n.jsx)("span",{className:"text-xs",children:m})})]})})}function o(e){let{onChatChange:t,userId:s}=e,[r,a]=(0,l.useState)([]),[o,u]=(0,l.useState)(!1),[d,m]=(0,l.useState)(-1);(0,l.useEffect)(()=>{u(!0),i(s).then(e=>{a(e),u(!1)})},[]);let x=(e,s)=>{m(e);let n=new Map;s.users.forEach(e=>{n.set(e.id,e)}),t({...s.game,users:{get:e=>n.get(e).username,get_target_user:e=>s.users.filter(t=>t.id!=e).map(e=>e.username).join("")}})};return(0,n.jsxs)("div",{className:"overflow-hidden space-y-3",children:[o&&(0,n.jsx)("p",{children:"Loading game lists."}),0==r.length&&(0,n.jsx)("p",{children:"No games yet."}),r.map((e,t)=>(0,n.jsx)(c,{onSelect:t=>x(t,e),game:{...e.game,users:e.users},index:t,userId:s,selectedItem:d},e.game.id))]})}async function u(e){let{username:t}=e;try{return(await fetch("http://localhost:8080/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t})})).json()}catch(e){return Promise.reject(e)}}async function d(e){let{username:t}=e;try{return(await fetch("http://localhost:8080/users/username/"+t)).json()}catch(e){return Promise.reject(e)}}function m(e){let{show:t,setAuth:s}=e,[r,a]=(0,l.useState)(!1),i=()=>{a(e=>!e)},c=e=>{let{setAuth:t}=e,s=async e=>{e.preventDefault();let s=e.target.username.value;if(""===s)return;let n=await u({username:s});if(null===n){alert("Failed to create account");return}t(n)};return(0,n.jsxs)("form",{action:"",className:"mt-4 space-y-2",onSubmit:s,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-light",children:"Username"}),(0,n.jsx)("input",{required:!0,type:"text",name:"username",placeholder:"Jhon Doe",className:"w-full px-4 py-2 mt-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-600"})]}),(0,n.jsx)("div",{className:"flex items-baseline justify-between",children:(0,n.jsx)("button",{type:"submit",className:"px-6 py-2 mt-4 text-white bg-violet-600 rounded-lg hover:bg-violet-700 w-full",children:"Submit"})}),(0,n.jsx)("div",{className:"pt-2 space-y-2 text-center",children:(0,n.jsxs)("p",{className:"text-base text-gray-700",children:["Already have a username? ",(0,n.jsx)("button",{onClick:i,className:"text-violet-700 font-light",children:"Sign In"})]})})]})},o=e=>{let{setAuth:t}=e,s=async e=>{e.preventDefault();let s=e.target.username.value;if(""===s)return;let n=await d({username:s});if(null===n){alert("Failed to create account");return}if(!n.id){alert("User not found ".concat(s));return}t(n)};return(0,n.jsxs)("form",{action:"",className:"mt-4 space-y-2",onSubmit:s,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-light",children:"Username"}),(0,n.jsx)("input",{required:!0,type:"text",name:"username",placeholder:"Chad",className:"w-full px-4 py-2 mt-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-600"})]}),(0,n.jsx)("div",{className:"flex items-baseline justify-between",children:(0,n.jsx)("button",{type:"submit",className:"px-6 py-2 mt-4 text-white bg-violet-600 rounded-lg hover:bg-violet-700 w-full",children:"Submit"})}),(0,n.jsx)("div",{className:"pt-2 space-y-2 text-center",children:(0,n.jsxs)("p",{className:"text-base text-gray-700",children:["Don't have username? ",(0,n.jsx)("button",{onClick:i,className:"text-violet-700 font-light",children:"Create"})]})})]})};return(0,n.jsx)("div",{className:"".concat(t?"":"hidden"," bg-gradient-to-b from-orange-400 to-rose-400"),children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"px-8 py-6 mt-4 text-left bg-white  max-w-[400px] w-full rounded-xl shadow-lg",children:[(0,n.jsx)("h3",{className:"text-xl text-slate-800 font-semibold",children:r?"Log in with your username.":"Create your account."}),r?(0,n.jsx)(o,{setAuth:s}):(0,n.jsx)(c,{setAuth:s})]})})})}let x=async e=>{if(e)try{return await fetch("http://localhost:8080/moves/".concat(e)).then(e=>e.json())}catch(e){console.log(e)}};function h(){let[e,t]=(0,l.useState)(null),[s,r]=(0,l.useState)(!1),[i,c]=function(e,t){let[s,n]=(0,l.useState)(t),r=t=>{try{let r=t instanceof Function?t(s):t;n(r),window.localStorage.setItem(e,JSON.stringify(r))}catch(e){}};return(0,l.useEffect)(()=>{try{let s=window.localStorage.getItem(e),r=s?JSON.parse(s):t;n(r)}catch(e){}},[]),[s,r]}("user",!1),[u,d,h,f]=function(e){let[t,s]=(0,l.useState)(!0),[n,r]=(0,l.useState)([]),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];s(!1),r(e)},i=e=>{s(!0),x(e).then(a)};return(0,l.useEffect)(()=>i(""),[]),[t,n,r,i]}(0),p=e=>{"IN"===e?setIsTyping(!0):setIsTyping(!1)},g=(e,t)=>{h(s=>[...s,{content:e,user_id:t}])},j=e=>{try{let t=JSON.parse(e);switch(t.chat_type){case"TYPING":p(t.value[0]);return;case"TEXT":g(t.value[0],t.user_id);return}}catch(e){console.log(e)}},b=function(e){let t=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(null!==t.current)return;t.current=new WebSocket("ws://localhost:8080/ws"),t.current.onopen=()=>console.log("ws opened"),t.current.onclose=()=>console.log("ws closed");let e=t.current;return()=>{e.close()}},[]),(0,l.useEffect)(()=>{t.current&&(t.current.onmessage=t=>{e(t.data)})},[]);let s=e=>{t.current&&t.current.send(e)};return s}(j),v=()=>{let t={id:0,chat_type:"TYPING",value:["IN"],game_id:e.id,user_id:i.id};b(JSON.stringify(t))},y=()=>{let t={id:0,chat_type:"TYPING",value:["OUT"],game_id:e.id,user_id:i.id};b(JSON.stringify(t))},w=t=>{t.preventDefault();let s=t.target.message.value;if(""===s)return;if(!e.id){alert("Please select game room!");return}let n={id:0,chat_type:"TEXT",value:[s],game_id:e.id,user_id:i.id};b(JSON.stringify(n)),t.target.message.value="",g(s,i.id),y()},N=e=>{e.id&&(fetchConversations(e.id),setSelectedRoom(e))},_=()=>{window.localStorage.removeItem("user"),c(!1)};return(0,l.useEffect)(()=>r(!i),[i]),(0,n.jsxs)("div",{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"Rust with react chat app"}),(0,n.jsx)("meta",{name:"description",content:"Rust with react chat app"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)(m,{show:s,setAuth:c}),(0,n.jsx)("div",{className:"".concat(!i&&"hidden"," bg-gradient-to-b from-orange-400 to-rose-400 h-screen p-12"),children:(0,n.jsxs)("main",{className:"flex w-full max-w-[1020px] h-[700px] mx-auto bg-[#FAF9FE] rounded-[25px] backdrop-opacity-30 opacity-95",children:[(0,n.jsxs)("aside",{className:"bg-[#F0EEF5] w-[325px] h-[700px] rounded-l-[25px] p-4 overflow-auto relative",children:[(0,n.jsx)(o,{onGameChange:N,userId:i.id}),(0,n.jsx)("button",{onClick:_,className:"text-xs w-full max-w-[295px] p-3 rounded-[10px] bg-violet-200 font-semibold text-violet-600 text-center absolute bottom-4",children:"LOG OUT"})]}),(null==e?void 0:e.id)&&(0,n.jsxs)("section",{className:"rounded-r-[25px] w-full max-w-[690px] grid grid-rows-[80px_minmax(450px,_1fr)_65px]",children:[(0,n.jsxs)("div",{className:"rounded-tr-[25px] w-ful",children:[(0,n.jsxs)("div",{className:"flex gap-3 p-3 items-center",children:[(0,n.jsx)(Avatar,{color:"rgb(245 158 11)",children:room.users.get_target_user(i.id)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold text-gray-600 text-base",children:room.users.get_target_user(i.id)}),(0,n.jsx)("div",{className:"text-xs text-gray-400",children:isTyping?"Typing...":"10:15 AM"})]})]}),(0,n.jsx)("hr",{className:"bg-[#F0EEF5]"})]}),u&&room.id&&(0,n.jsx)("p",{className:"px-4 text-slate-500",children:"Loading conversation..."}),(0,n.jsx)(Conversation,{data:d,auth:i,users:room.users}),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("form",{onSubmit:w,className:"flex gap-2 items-center rounded-full border border-violet-500 bg-violet-200 p-1 m-2",children:[(0,n.jsx)("input",{onBlur:y,onFocus:v,name:"message",className:"p-2 placeholder-gray-600 text-sm w-full rounded-full bg-violet-200 focus:outline-none",placeholder:"Type your message here..."}),(0,n.jsx)("button",{type:"submit",className:"bg-violet-500 rounded-full py-2 px-6 font-semibold text-white text-sm",children:"Sent"})]})})]})]})})]})}},9008:function(e,t,s){e.exports=s(3121)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);